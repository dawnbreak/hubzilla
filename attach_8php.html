<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>The Hubzilla: include/attach.php File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="rm-64.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">The Hubzilla
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('attach_8php.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">attach.php File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>File/attach API with the potential for revision control.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a6fdd92775f31c07d2863e16e0026018a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#a6fdd92775f31c07d2863e16e0026018a">z_mime_content_type</a> ($filename)</td></tr>
<tr class="memdesc:a6fdd92775f31c07d2863e16e0026018a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Guess the mimetype from file ending.  <a href="#a6fdd92775f31c07d2863e16e0026018a">More...</a><br/></td></tr>
<tr class="separator:a6fdd92775f31c07d2863e16e0026018a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a887d2d44a3ef18dcb6624e7fb58dc8e3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#a887d2d44a3ef18dcb6624e7fb58dc8e3">attach_count_files</a> ($channel_id, $observer, $hash= '', $filename= '', $filetype= '')</td></tr>
<tr class="memdesc:a887d2d44a3ef18dcb6624e7fb58dc8e3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Count files/attachments.  <a href="#a887d2d44a3ef18dcb6624e7fb58dc8e3">More...</a><br/></td></tr>
<tr class="separator:a887d2d44a3ef18dcb6624e7fb58dc8e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8fb6e463b13175979c79bce5971d1449"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#a8fb6e463b13175979c79bce5971d1449">attach_list_files</a> ($channel_id, $observer, $hash= '', $filename= '', $filetype= '', $orderby= 'created desc', $start=0, $entries=0, $since= '', $until= '')</td></tr>
<tr class="memdesc:a8fb6e463b13175979c79bce5971d1449"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns a list of files/attachments.  <a href="#a8fb6e463b13175979c79bce5971d1449">More...</a><br/></td></tr>
<tr class="separator:a8fb6e463b13175979c79bce5971d1449"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58127952a3f48796f966f0ea20276c75"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#a58127952a3f48796f966f0ea20276c75">attach_by_hash</a> ($hash, $observer_hash, $rev=0)</td></tr>
<tr class="memdesc:a58127952a3f48796f966f0ea20276c75"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find an attachment by hash and revision.  <a href="#a58127952a3f48796f966f0ea20276c75">More...</a><br/></td></tr>
<tr class="separator:a58127952a3f48796f966f0ea20276c75"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45e3847775ea6e5014117ffedbed11ef"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#a45e3847775ea6e5014117ffedbed11ef">attach_can_view_folder</a> ($uid, $ob_hash, $folder_hash)</td></tr>
<tr class="separator:a45e3847775ea6e5014117ffedbed11ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2b32c36556159058d8597100cff31ee"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#af2b32c36556159058d8597100cff31ee">attach_by_hash_nodata</a> ($hash, $observer_hash, $rev=0)</td></tr>
<tr class="memdesc:af2b32c36556159058d8597100cff31ee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find an attachment by hash and revision.  <a href="#af2b32c36556159058d8597100cff31ee">More...</a><br/></td></tr>
<tr class="separator:af2b32c36556159058d8597100cff31ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84a8a64c4805e1525b42d4add464833f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#a84a8a64c4805e1525b42d4add464833f">attach_store</a> ($channel, $observer_hash, $options= '', $arr=null)</td></tr>
<tr class="memdesc:a84a8a64c4805e1525b42d4add464833f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stores an attachment from a POST file upload.  <a href="#a84a8a64c4805e1525b42d4add464833f">More...</a><br/></td></tr>
<tr class="separator:a84a8a64c4805e1525b42d4add464833f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb07968990e66a88c95483ca09a7f909"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#aeb07968990e66a88c95483ca09a7f909">z_readdir</a> ($channel_id, $observer_hash, $pathname, $parent_hash= '')</td></tr>
<tr class="memdesc:aeb07968990e66a88c95483ca09a7f909"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read a virtual directory and return contents.  <a href="#aeb07968990e66a88c95483ca09a7f909">More...</a><br/></td></tr>
<tr class="separator:aeb07968990e66a88c95483ca09a7f909"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6830b3ab74a5d284876141ac80f6cbc"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#ab6830b3ab74a5d284876141ac80f6cbc">attach_mkdir</a> ($channel, $observer_hash, $arr=null)</td></tr>
<tr class="memdesc:ab6830b3ab74a5d284876141ac80f6cbc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create directory.  <a href="#ab6830b3ab74a5d284876141ac80f6cbc">More...</a><br/></td></tr>
<tr class="separator:ab6830b3ab74a5d284876141ac80f6cbc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b6693f0109bd5d38b70ff6395ab7697"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#a8b6693f0109bd5d38b70ff6395ab7697">attach_mkdirp</a> ($channel, $observer_hash, $arr=null)</td></tr>
<tr class="memdesc:a8b6693f0109bd5d38b70ff6395ab7697"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create directory (recursive).  <a href="#a8b6693f0109bd5d38b70ff6395ab7697">More...</a><br/></td></tr>
<tr class="separator:a8b6693f0109bd5d38b70ff6395ab7697"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a97caa53317213377dac8b95631a284b3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#a97caa53317213377dac8b95631a284b3">attach_change_permissions</a> ($channel_id, $resource, $allow_cid, $allow_gid, $deny_cid, $deny_gid, $recurse=false, $sync=false)</td></tr>
<tr class="memdesc:a97caa53317213377dac8b95631a284b3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Changes permissions of a file.  <a href="#a97caa53317213377dac8b95631a284b3">More...</a><br/></td></tr>
<tr class="separator:a97caa53317213377dac8b95631a284b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7061d6f24286f27fd924ea8d81e08247"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#a7061d6f24286f27fd924ea8d81e08247">attach_delete</a> ($channel_id, $resource, $is_photo=0)</td></tr>
<tr class="memdesc:a7061d6f24286f27fd924ea8d81e08247"><td class="mdescLeft">&#160;</td><td class="mdescRight">Delete a file/directory from a channel.  <a href="#a7061d6f24286f27fd924ea8d81e08247">More...</a><br/></td></tr>
<tr class="separator:a7061d6f24286f27fd924ea8d81e08247"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87572cbb2d59f229d74467e92b122a55"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#a87572cbb2d59f229d74467e92b122a55">attach_drop_photo</a> ($channel_id, $resource)</td></tr>
<tr class="separator:a87572cbb2d59f229d74467e92b122a55"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6aa00ea010ea030110faefb75eafc1ce"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#a6aa00ea010ea030110faefb75eafc1ce">get_cloudpath</a> ($arr)</td></tr>
<tr class="memdesc:a6aa00ea010ea030110faefb75eafc1ce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns path to file in cloud/.  <a href="#a6aa00ea010ea030110faefb75eafc1ce">More...</a><br/></td></tr>
<tr class="separator:a6aa00ea010ea030110faefb75eafc1ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab785eb451835c8f8a213042133a12e62"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#ab785eb451835c8f8a213042133a12e62">get_cloud_url</a> ($channel_id, $channel_name, $attachHash)</td></tr>
<tr class="memdesc:ab785eb451835c8f8a213042133a12e62"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns path to parent folder in cloud/. This function cannot be used with mod/dav as it always returns a path valid under mod/cloud.  <a href="#ab785eb451835c8f8a213042133a12e62">More...</a><br/></td></tr>
<tr class="separator:ab785eb451835c8f8a213042133a12e62"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f19988ce50d8f872c941a22694c3972"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#a7f19988ce50d8f872c941a22694c3972">find_folder_hash_by_attach_hash</a> ($channel_id, $attachHash, $recurse=false)</td></tr>
<tr class="memdesc:a7f19988ce50d8f872c941a22694c3972"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the hash of an attachment's folder.  <a href="#a7f19988ce50d8f872c941a22694c3972">More...</a><br/></td></tr>
<tr class="separator:a7f19988ce50d8f872c941a22694c3972"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ab2051597de1ff1b86e16f142900ad7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#a3ab2051597de1ff1b86e16f142900ad7">find_folder_hash_by_path</a> ($channel_id, $path)</td></tr>
<tr class="memdesc:a3ab2051597de1ff1b86e16f142900ad7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the hash of an attachment's folder.  <a href="#a3ab2051597de1ff1b86e16f142900ad7">More...</a><br/></td></tr>
<tr class="separator:a3ab2051597de1ff1b86e16f142900ad7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4dbfd7e1cef52aa9ef52f4b88929fa86"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#a4dbfd7e1cef52aa9ef52f4b88929fa86">find_filename_by_hash</a> ($channel_id, $attachHash)</td></tr>
<tr class="memdesc:a4dbfd7e1cef52aa9ef52f4b88929fa86"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the filename of an attachment in a given channel.  <a href="#a4dbfd7e1cef52aa9ef52f4b88929fa86">More...</a><br/></td></tr>
<tr class="separator:a4dbfd7e1cef52aa9ef52f4b88929fa86"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aedd96ecc99d14cf2ddc88c8638fbbe0c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#aedd96ecc99d14cf2ddc88c8638fbbe0c">pipe_streams</a> ($in, $out, $bufsize=16384)</td></tr>
<tr class="memdesc:aedd96ecc99d14cf2ddc88c8638fbbe0c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pipes $in to $out in 16KB chunks.  <a href="#aedd96ecc99d14cf2ddc88c8638fbbe0c">More...</a><br/></td></tr>
<tr class="separator:aedd96ecc99d14cf2ddc88c8638fbbe0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf4ce438da50e2462196c0c231489653"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#abf4ce438da50e2462196c0c231489653">file_activity</a> ($channel_id, $object, $allow_cid, $allow_gid, $deny_cid, $deny_gid, $verb, $notify)</td></tr>
<tr class="memdesc:abf4ce438da50e2462196c0c231489653"><td class="mdescLeft">&#160;</td><td class="mdescRight">Activity for files.  <a href="#abf4ce438da50e2462196c0c231489653">More...</a><br/></td></tr>
<tr class="separator:abf4ce438da50e2462196c0c231489653"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad5cece3be0c0a3409d8c4a26255f993"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#aad5cece3be0c0a3409d8c4a26255f993">get_file_activity_object</a> ($channel_id, $hash, $url)</td></tr>
<tr class="memdesc:aad5cece3be0c0a3409d8c4a26255f993"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create file activity object.  <a href="#aad5cece3be0c0a3409d8c4a26255f993">More...</a><br/></td></tr>
<tr class="separator:aad5cece3be0c0a3409d8c4a26255f993"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade58a2913fcbec2d7d7d5f1601220b8d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#ade58a2913fcbec2d7d7d5f1601220b8d">attach_recursive_perms</a> ($arr_allow_cid, $arr_allow_gid, $arr_deny_cid, $arr_deny_gid, $folder_hash)</td></tr>
<tr class="memdesc:ade58a2913fcbec2d7d7d5f1601220b8d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns recursive permissions array or false if nobody has recursive permissions.  <a href="#ade58a2913fcbec2d7d7d5f1601220b8d">More...</a><br/></td></tr>
<tr class="separator:ade58a2913fcbec2d7d7d5f1601220b8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ced6d7fe6aa755ee4cf5cbec8eefeef"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#a1ced6d7fe6aa755ee4cf5cbec8eefeef">filepath_macro</a> ($s)</td></tr>
<tr class="separator:a1ced6d7fe6aa755ee4cf5cbec8eefeef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeed45de729e5d5a0c5eb4882c89c160b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#aeed45de729e5d5a0c5eb4882c89c160b">attach_export_data</a> ($channel, $resource_id, $deleted=false)</td></tr>
<tr class="separator:aeed45de729e5d5a0c5eb4882c89c160b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53606bfc162c615180f559a0609aebf2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#a53606bfc162c615180f559a0609aebf2">get_attach_binname</a> ($s)</td></tr>
<tr class="memdesc:a53606bfc162c615180f559a0609aebf2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Strip off 'store/nickname/' from the provided path.  <a href="#a53606bfc162c615180f559a0609aebf2">More...</a><br/></td></tr>
<tr class="separator:a53606bfc162c615180f559a0609aebf2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8a92e1ada8ff3126270bff97566d40f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#ad8a92e1ada8ff3126270bff97566d40f">get_dirpath_by_cloudpath</a> ($channel, $path)</td></tr>
<tr class="separator:ad8a92e1ada8ff3126270bff97566d40f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5634d680a3d80e4fb60b1ffa55145fb1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#a5634d680a3d80e4fb60b1ffa55145fb1">get_filename_by_cloudname</a> ($cloudname, $channel, $storepath)</td></tr>
<tr class="separator:a5634d680a3d80e4fb60b1ffa55145fb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f28a34205316c66601f79cf44639962"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#a7f28a34205316c66601f79cf44639962">copy_folder_to_cloudfiles</a> ($channel, $observer_hash, $srcpath, $cloudpath)</td></tr>
<tr class="memdesc:a7f28a34205316c66601f79cf44639962"><td class="mdescLeft">&#160;</td><td class="mdescRight">recursively copy a directory into cloud files  <a href="#a7f28a34205316c66601f79cf44639962">More...</a><br/></td></tr>
<tr class="separator:a7f28a34205316c66601f79cf44639962"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a764f675746ce71c0437326fd8b0c29a4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#a764f675746ce71c0437326fd8b0c29a4">attach_move</a> ($channel_id, $resource_id, $new_folder_hash)</td></tr>
<tr class="separator:a764f675746ce71c0437326fd8b0c29a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36bdbf9fbfd78169e12eb417c0b26fba"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#a36bdbf9fbfd78169e12eb417c0b26fba">attach_folder_select_list</a> ($channel_id)</td></tr>
<tr class="separator:a36bdbf9fbfd78169e12eb417c0b26fba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a726e0cc6db2096172a2eccad4d9ecc5a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#a726e0cc6db2096172a2eccad4d9ecc5a">attach_folder_rpaths</a> ($all_folders, $that_folder)</td></tr>
<tr class="separator:a726e0cc6db2096172a2eccad4d9ecc5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0aa602f0cd98b190aed85abe5be4be6b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#a0aa602f0cd98b190aed85abe5be4be6b">attach_syspaths</a> ($channel_id, $attach_hash)</td></tr>
<tr class="memdesc:a0aa602f0cd98b190aed85abe5be4be6b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Given a channel_id and attach_hash, return an array with the full relative path and os_path.  <a href="#a0aa602f0cd98b190aed85abe5be4be6b">More...</a><br/></td></tr>
<tr class="separator:a0aa602f0cd98b190aed85abe5be4be6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1327180150029dd539aaf56b65fa800f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#a1327180150029dd539aaf56b65fa800f">attach_upgrade</a> ()</td></tr>
<tr class="separator:a1327180150029dd539aaf56b65fa800f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c6f1b70468e38a701414fc240d1cba4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="attach_8php.html#a4c6f1b70468e38a701414fc240d1cba4">save_chunk</a> ($channel, $start, $end, $len)</td></tr>
<tr class="separator:a4c6f1b70468e38a701414fc240d1cba4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>File/attach API with the potential for revision control. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000004">Todo:</a></b></dt><dd><p class="startdd">A filesystem storage abstraction which maintains security (and 'data' contains a system filename which is inaccessible from the web). This could get around PHP storage limits and store videos and larger items, using fread or OS methods or native code to read/write or chunk it through. </p>
<p class="enddd">Also an 'append' option to the storage function might be a useful addition. </p>
</dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a58127952a3f48796f966f0ea20276c75"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">attach_by_hash </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$observer_hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$rev</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Find an attachment by hash and revision. </p>
<p>Returns the entire attach structure including data.</p>
<p>This could exhaust memory so most useful only when immediately sending the data.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$hash</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$observer_hash</td><td></td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$rev</td><td>(optional) Revision default 0 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array </dd></dl>

<p>Referenced by <a class="el" href="classZotlabs_1_1Module_1_1Attach.html#aafc199affca1d59ec197df9202b81554">Zotlabs\Module\Attach\init()</a>, <a class="el" href="classZotlabs_1_1Module_1_1Getfile.html#a5583b6d774eff8e3108f86e79a1d7e11">Zotlabs\Module\Getfile\post()</a>, and <a class="el" href="import_8php.html#a341357f0b55dcf2eed3ab632fff6a707">sync_files()</a>.</p>

</div>
</div>
<a class="anchor" id="af2b32c36556159058d8597100cff31ee"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">attach_by_hash_nodata </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$observer_hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$rev</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Find an attachment by hash and revision. </p>
<p>Returns the entire attach structure excluding data.</p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="attach_8php.html#a58127952a3f48796f966f0ea20276c75" title="Find an attachment by hash and revision. ">attach_by_hash()</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$hash</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$observer_hash</td><td></td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$rev</td><td>(optional) revision default 0 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>associative array with everything except data<ul>
<li><em>boolean</em> <b>success</b> boolean true or false</li>
<li><em>string</em> <b>message</b> (optional) only when success is false</li>
<li><em>array</em> <b>data</b> array of attach DB entry without data component </li>
</ul>
</dd></dl>

<p>Referenced by <a class="el" href="classZotlabs_1_1Module_1_1Photos.html#a0d6e2c668a49cb511cfec0e421d875bb">Zotlabs\Module\Photos\get()</a>, <a class="el" href="classZotlabs_1_1Module_1_1Mail.html#a7bc799bf364fc7986da6566618899c3e">Zotlabs\Module\Mail\post()</a>, <a class="el" href="classZotlabs_1_1Module_1_1Item.html#add2495ae77a351158ab92566298dce29">Zotlabs\Module\Item\post()</a>, and <a class="el" href="message_8php.html#a0c217aac24f07f00cd247b451715bb1f">send_message()</a>.</p>

</div>
</div>
<a class="anchor" id="a45e3847775ea6e5014117ffedbed11ef"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">attach_can_view_folder </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$uid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$ob_hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$folder_hash</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Referenced by <a class="el" href="attach_8php.html#a58127952a3f48796f966f0ea20276c75">attach_by_hash()</a>, <a class="el" href="attach_8php.html#af2b32c36556159058d8597100cff31ee">attach_by_hash_nodata()</a>, <a class="el" href="classZotlabs_1_1Module_1_1Embedphotos.html#a5f6836cfc699a6eede224a3c98650c96">Zotlabs\Module\Embedphotos\embedphotos_widget_album()</a>, <a class="el" href="photos_8php.html#adebb3d9bf0a5f42faef738d432a5943b">photos_albums_list()</a>, <a class="el" href="classZotlabs_1_1Widget_1_1Portfolio.html#aaf58b8bbf8426bb94d1d58b2db9e2567">Zotlabs\Widget\Portfolio\widget()</a>, and <a class="el" href="classZotlabs_1_1Widget_1_1Album.html#a0eafae3a0faa2f7df8761e758029ec9a">Zotlabs\Widget\Album\widget()</a>.</p>

</div>
</div>
<a class="anchor" id="a97caa53317213377dac8b95631a284b3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">attach_change_permissions </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$channel_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$resource</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$allow_cid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$allow_gid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$deny_cid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$deny_gid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$recurse</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$sync</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Changes permissions of a file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$channel_id</td><td>The id of the channel </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$resource</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$allow_cid</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$allow_gid</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$deny_cid</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$deny_gid</td><td></td></tr>
    <tr><td class="paramtype">boolean</td><td class="paramname">$recurse</td><td>(optional) default false </td></tr>
    <tr><td class="paramtype">boolean</td><td class="paramname">$sync</td><td>(optional) default false </td></tr>
  </table>
  </dd>
</dl>

<p>Referenced by <a class="el" href="classZotlabs_1_1Module_1_1Filestorage.html#a010e48dbc4869078c36f49ae153c6997">Zotlabs\Module\Filestorage\post()</a>.</p>

</div>
</div>
<a class="anchor" id="a887d2d44a3ef18dcb6624e7fb58dc8e3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">attach_count_files </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$channel_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$observer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$hash</em> = <code>''</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filename</em> = <code>''</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filetype</em> = <code>''</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Count files/attachments. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$channel_id</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$observer</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$hash</td><td>(optional) </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filename</td><td>(optional) </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filetype</td><td>(optional) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>associative array with:<ul>
<li><em>boolean</em> <b>success</b> </li>
<li><em>int|boolean</em> <b>results</b> amount of found results, or false</li>
<li><em>string</em> <b>message</b> with error messages if any </li>
</ul>
</dd></dl>

</div>
</div>
<a class="anchor" id="a7061d6f24286f27fd924ea8d81e08247"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">attach_delete </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$channel_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$resource</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$is_photo</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Delete a file/directory from a channel. </p>
<p>If the provided resource hash is from a directory it will delete everything recursively under this directory.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$channel_id</td><td>The id of the channel </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$resource</td><td>The hash to delete </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$is_photo</td><td>(optional) default 0 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

<p>Referenced by <a class="el" href="channel_8php.html#a98b9cba604dcd8cfb15d5978a50b2e38">channel_remove()</a>, <a class="el" href="classZotlabs_1_1Module_1_1Filestorage.html#a15e688a16894866833acf5cd26577270">Zotlabs\Module\Filestorage\get()</a>, <a class="el" href="classZotlabs_1_1Module_1_1Photos.html#a29612aeb73997a308f89d945acd117c5">Zotlabs\Module\Photos\post()</a>, and <a class="el" href="import_8php.html#a341357f0b55dcf2eed3ab632fff6a707">sync_files()</a>.</p>

</div>
</div>
<a class="anchor" id="a87572cbb2d59f229d74467e92b122a55"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">attach_drop_photo </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$channel_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$resource</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Referenced by <a class="el" href="attach_8php.html#a7061d6f24286f27fd924ea8d81e08247">attach_delete()</a>.</p>

</div>
</div>
<a class="anchor" id="aeed45de729e5d5a0c5eb4882c89c160b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">attach_export_data </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$resource_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$deleted</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Referenced by <a class="el" href="api__zot_8php.html#a77c27afb33cd72019ffdf2ee880be0df">api_file_export()</a>, <a class="el" href="attach_8php.html#a97caa53317213377dac8b95631a284b3">attach_change_permissions()</a>, <a class="el" href="attach_8php.html#a84a8a64c4805e1525b42d4add464833f">attach_store()</a>, <a class="el" href="classZotlabs_1_1Module_1_1Filestorage.html#a15e688a16894866833acf5cd26577270">Zotlabs\Module\Filestorage\get()</a>, <a class="el" href="classZotlabs_1_1Module_1_1Profile__photo.html#a0f5521c97fcfc46cd1a0de6312baed03">Zotlabs\Module\Profile_photo\get()</a>, <a class="el" href="classZotlabs_1_1Module_1_1File__upload.html#a5b1c21449dd5faae85f68ff1038c8d63">Zotlabs\Module\File_upload\post()</a>, <a class="el" href="classZotlabs_1_1Module_1_1Wall__attach.html#a40b935fa19f0fad3724202167c3d8536">Zotlabs\Module\Wall_attach\post()</a>, <a class="el" href="classZotlabs_1_1Module_1_1Profile__photo.html#abb1cfd520e0afa9cdf7c2ca0e9836883">Zotlabs\Module\Profile_photo\post()</a>, <a class="el" href="classZotlabs_1_1Module_1_1Photos.html#a29612aeb73997a308f89d945acd117c5">Zotlabs\Module\Photos\post()</a>, and <a class="el" href="classZotlabs_1_1Daemon_1_1Importfile.html#a328cc21f76e43b7a6856f61372b3cc6b">Zotlabs\Daemon\Importfile\run()</a>.</p>

</div>
</div>
<a class="anchor" id="a726e0cc6db2096172a2eccad4d9ecc5a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">attach_folder_rpaths </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$all_folders</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$that_folder</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Referenced by <a class="el" href="attach_8php.html#a36bdbf9fbfd78169e12eb417c0b26fba">attach_folder_select_list()</a>.</p>

</div>
</div>
<a class="anchor" id="a36bdbf9fbfd78169e12eb417c0b26fba"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">attach_folder_select_list </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$channel_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Used to generate a select input box of all your folders </p>

</div>
</div>
<a class="anchor" id="a8fb6e463b13175979c79bce5971d1449"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">attach_list_files </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$channel_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$observer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$hash</em> = <code>''</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filename</em> = <code>''</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filetype</em> = <code>''</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$orderby</em> = <code>'created&#160;desc'</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$start</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$entries</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$since</em> = <code>''</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$until</em> = <code>''</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns a list of files/attachments. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$channel_id</td><td></td></tr>
    <tr><td class="paramname">$observer</td><td></td></tr>
    <tr><td class="paramname">$hash</td><td>(optional) </td></tr>
    <tr><td class="paramname">$filename</td><td>(optional) </td></tr>
    <tr><td class="paramname">$filetype</td><td>(optional) </td></tr>
    <tr><td class="paramname">$orderby</td><td></td></tr>
    <tr><td class="paramname">$start</td><td></td></tr>
    <tr><td class="paramname">$entries</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>associative array with:<ul>
<li><em>boolean</em> <b>success</b> </li>
<li><em>array|boolean</em> <b>results</b> array with results, or false</li>
<li><em>string</em> <b>message</b> with error messages if any </li>
</ul>
</dd></dl>

<p>Referenced by <a class="el" href="api__zot_8php.html#a91524588da9e2b7ed3eda5479e365426">api_attach_list()</a>.</p>

</div>
</div>
<a class="anchor" id="ab6830b3ab74a5d284876141ac80f6cbc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">attach_mkdir </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$observer_hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$arr</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create directory. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$channel</td><td>channel array of owner </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$observer_hash</td><td>hash of current observer </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$arr</td><td>parameter array to fulfil request<ul>
<li>Required:<ul>
<li><em>string</em> <b>filename</b> </li>
<li><em>string</em> <b>folder</b> hash of parent directory, empty string for root directory</li>
</ul>
</li>
<li>Optional:<ul>
<li><em>string</em> <b>hash</b> precomputed hash for this node</li>
<li><em>tring</em> <b>allow_cid</b> </li>
<li><em>string</em> <b>allow_gid</b> </li>
<li><em>string</em> <b>deny_cid</b> </li>
<li><em>string</em> <b>deny_gid</b> </li>
</ul>
</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array </dd></dl>

<p>Referenced by <a class="el" href="attach_8php.html#a8b6693f0109bd5d38b70ff6395ab7697">attach_mkdirp()</a>, <a class="el" href="attach_8php.html#a84a8a64c4805e1525b42d4add464833f">attach_store()</a>, and <a class="el" href="classZotlabs_1_1Module_1_1File__upload.html#a5b1c21449dd5faae85f68ff1038c8d63">Zotlabs\Module\File_upload\post()</a>.</p>

</div>
</div>
<a class="anchor" id="a8b6693f0109bd5d38b70ff6395ab7697"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">attach_mkdirp </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$observer_hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$arr</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create directory (recursive). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$channel</td><td>channel array of owner </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$observer_hash</td><td>hash of current observer </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$arr</td><td>parameter array to fulfil request<ul>
<li>Required:<ul>
<li><em>string</em> <b>pathname</b> </li>
<li><em>string</em> <b>folder</b> hash of parent directory, empty string for root directory</li>
</ul>
</li>
<li>Optional:<ul>
<li><em>string</em> <b>allow_cid</b> </li>
<li><em>string</em> <b>allow_gid</b> </li>
<li><em>string</em> <b>deny_cid</b> </li>
<li><em>string</em> <b>deny_gid</b> </li>
</ul>
</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array </dd></dl>

<p>Referenced by <a class="el" href="attach_8php.html#a84a8a64c4805e1525b42d4add464833f">attach_store()</a>, <a class="el" href="attach_8php.html#a7f28a34205316c66601f79cf44639962">copy_folder_to_cloudfiles()</a>, and <a class="el" href="classZotlabs_1_1Module_1_1Webpages.html#a63f69b9dafc236af4e62341a5c3d37c9">Zotlabs\Module\Webpages\post()</a>.</p>

</div>
</div>
<a class="anchor" id="a764f675746ce71c0437326fd8b0c29a4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">attach_move </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$channel_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$resource_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$new_folder_hash</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function performs an in place directory-to-directory move of a stored attachment or photo. The data is physically moved in the store/nickname storage location and the paths adjusted in the attach structure (and if applicable the photo table). The new 'album name' is recorded for photos and will show up immediately there. This takes a channel_id, attach.hash of the file to move (this is the same as a photo resource_id), and the attach.hash of the new parent folder, which must already exist. If $new_folder_hash is blank or empty, the file is relocated to the root of the channel's storage area.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$channel_id</td><td></td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$resource_id</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$new_folder_hash</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void|boolean </dd></dl>
<dl class="fixme"><dt><b><a class="el" href="fixme.html#_fixme000001">Fixme:</a></b></dt><dd></dd></dl>

<p>Referenced by <a class="el" href="classZotlabs_1_1Module_1_1Photos.html#a29612aeb73997a308f89d945acd117c5">Zotlabs\Module\Photos\post()</a>.</p>

</div>
</div>
<a class="anchor" id="ade58a2913fcbec2d7d7d5f1601220b8d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">attach_recursive_perms </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$arr_allow_cid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$arr_allow_gid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$arr_deny_cid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$arr_deny_gid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$folder_hash</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns recursive permissions array or false if nobody has recursive permissions. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$arr_allow_cid</td><td></td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$arr_allow_gid</td><td></td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$arr_deny_cid</td><td></td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$arr_deny_gid</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$folder_hash</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Referenced by <a class="el" href="attach_8php.html#abf4ce438da50e2462196c0c231489653">file_activity()</a>.</p>

</div>
</div>
<a class="anchor" id="a84a8a64c4805e1525b42d4add464833f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">attach_store </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$observer_hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$options</em> = <code>''</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$arr</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stores an attachment from a POST file upload. </p>
<p>This function stores an attachment. It can be a new one, a replacement or a new revision depending on value set in <em>$options</em>.</p>
<dl class="section note"><dt>Note</dt><dd>Requires an input field <em>userfile</em> and does not accept multiple files in one request.</dd>
<dd>
A lot going on in this function, and some of it is old cruft and some is new cruft and the entire thing probably needs to be refactored. It started out just storing files, before we had DAV. It was made extensible to do extra stuff like edit an existing file or optionally store a separate revision using $options to choose between different storage models. Along the way we moved from DB data storage to file system storage. Then DAV came along and used different upload methods depending on whether the file was stored as a DAV directory object or updated as a file object. One of these is essentially an update and the other is basically an upload, but doesn't use the traditional PHP upload workflow. Then came hubzilla and we tried to merge photo functionality with the file storage. Most of that integration occurs within this function. This required overlap with the old photo_upload stuff and photo albums were completely different concepts from directories which needed to be reconciled somehow. The old revision stuff is kind of orphaned currently. There's new revision stuff for photos which attaches (2) etc. onto the name, but doesn't integrate with the attach table revisioning. That's where it sits currently. I repeat it needs to be refactored, and this note is here for future explorers and those who may be doing that work to understand where it came from and got to be the monstrosity of tangled unrelated code that it currently is.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$channel</td><td>channel array of owner </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$observer_hash</td><td>hash of current observer </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$options</td><td>(optional) one of update, replace, revision </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$arr</td><td>(optional) associative array </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void|array </dd></dl>
<dl class="hooks"><dt><b><a class="el" href="hooks.html#_hooks000007">Hooks:</a></b></dt><dd>photo_upload_begin Called when attempting to upload a photo. </dd></dl>
<dl class="hooks"><dt><b><a class="el" href="hooks.html#_hooks000008">Hooks:</a></b></dt><dd>photo_upload_file Called to generate alternate filenames for an upload.<ul>
<li><em>string</em> <b>src</b> - return value, default empty</li>
<li><em>string</em> <b>filename</b> - return value, default empty</li>
<li><em>number</em> <b>filesize</b> - return value, default 0</li>
<li><em>string</em> <b>type</b> - return value, default empty </li>
</ul>
</dd></dl>
<dl class="hooks"><dt><b><a class="el" href="hooks.html#_hooks000009">Hooks:</a></b></dt><dd>attach_upload_file Called when uploading a file.<ul>
<li><em>string</em> <b>src</b> - return value, default empty</li>
<li><em>string</em> <b>filename</b> - return value, default empty</li>
<li><em>number</em> <b>filesize</b> - return value, default 0</li>
<li><em>string</em> <b>type</b> - return value, default empty </li>
</ul>
</dd></dl>
<dl class="hooks"><dt><b><a class="el" href="hooks.html#_hooks000010">Hooks:</a></b></dt><dd>photo_upload_end Called when a photo upload has been processed. </dd></dl>
<dl class="hooks"><dt><b><a class="el" href="hooks.html#_hooks000011">Hooks:</a></b></dt><dd>photo_upload_end Called when a photo upload has been processed. </dd></dl>
<dl class="hooks"><dt><b><a class="el" href="hooks.html#_hooks000012">Hooks:</a></b></dt><dd>photo_upload_end Called when a photo upload has been processed. </dd></dl>
<dl class="hooks"><dt><b><a class="el" href="hooks.html#_hooks000013">Hooks:</a></b></dt><dd>photo_upload_end Called when a photo upload has been processed. </dd></dl>
<dl class="hooks"><dt><b><a class="el" href="hooks.html#_hooks000014">Hooks:</a></b></dt><dd>photo_upload_end Called when a photo upload has been processed. This would've been called already with a success result in photos_upload() if it was a photo. </dd></dl>

<p>Referenced by <a class="el" href="attach_8php.html#a7f28a34205316c66601f79cf44639962">copy_folder_to_cloudfiles()</a>, <a class="el" href="items_8php.html#a3daae7944f737bd30412a0d042207c0f">fix_attached_file_permissions()</a>, <a class="el" href="classZotlabs_1_1Module_1_1File__upload.html#a5b1c21449dd5faae85f68ff1038c8d63">Zotlabs\Module\File_upload\post()</a>, <a class="el" href="classZotlabs_1_1Module_1_1Wall__attach.html#a40b935fa19f0fad3724202167c3d8536">Zotlabs\Module\Wall_attach\post()</a>, <a class="el" href="classZotlabs_1_1Module_1_1Cover__photo.html#ac5ad4745ad5d748ebf73610d4ef86f57">Zotlabs\Module\Cover_photo\post()</a>, <a class="el" href="classZotlabs_1_1Module_1_1Profile__photo.html#abb1cfd520e0afa9cdf7c2ca0e9836883">Zotlabs\Module\Profile_photo\post()</a>, <a class="el" href="classZotlabs_1_1Module_1_1Photos.html#a29612aeb73997a308f89d945acd117c5">Zotlabs\Module\Photos\post()</a>, <a class="el" href="classZotlabs_1_1Daemon_1_1Importfile.html#a328cc21f76e43b7a6856f61372b3cc6b">Zotlabs\Daemon\Importfile\run()</a>, and <a class="el" href="message_8php.html#a0c217aac24f07f00cd247b451715bb1f">send_message()</a>.</p>

</div>
</div>
<a class="anchor" id="a0aa602f0cd98b190aed85abe5be4be6b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">attach_syspaths </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$channel_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$attach_hash</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Given a channel_id and attach_hash, return an array with the full relative path and os_path. </p>

<p>Referenced by <a class="el" href="attach_8php.html#a764f675746ce71c0437326fd8b0c29a4">attach_move()</a>, and <a class="el" href="attach_8php.html#a1327180150029dd539aaf56b65fa800f">attach_upgrade()</a>.</p>

</div>
</div>
<a class="anchor" id="a1327180150029dd539aaf56b65fa800f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">attach_upgrade </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>in earlier releases we did not fill in os_path and display_path in the attach DB structure. (It was not needed or used). Going forward we intend to make use of these fields. A cron task checks for empty values (as older attachments may have arrived at our site in a clone operation) and executes <a class="el" href="attach_8php.html#a0aa602f0cd98b190aed85abe5be4be6b" title="Given a channel_id and attach_hash, return an array with the full relative path and os_path...">attach_syspaths()</a> to generate these field values and correct the attach table entry. The operation is limited to 100 DB entries at a time so as not to overload the system in any cron run. Eventually it will catch up with old attach structures and switch into maintenance mode to correct any that might arrive in clone packets from older sites. </p>

<p>Referenced by <a class="el" href="classZotlabs_1_1Daemon_1_1Cron.html#a8158c89c74ddb9f5f129ff0edb801887">Zotlabs\Daemon\Cron\run()</a>.</p>

</div>
</div>
<a class="anchor" id="a7f28a34205316c66601f79cf44639962"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">copy_folder_to_cloudfiles </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$observer_hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$srcpath</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$cloudpath</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>recursively copy a directory into cloud files </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$channel</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$observer_hash</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$srcpath</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$cloudpath</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>boolean </dd></dl>

<p>Referenced by <a class="el" href="classZotlabs_1_1Module_1_1Webpages.html#a63f69b9dafc236af4e62341a5c3d37c9">Zotlabs\Module\Webpages\post()</a>.</p>

</div>
</div>
<a class="anchor" id="abf4ce438da50e2462196c0c231489653"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_activity </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$channel_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$object</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$allow_cid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$allow_gid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$deny_cid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$deny_gid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$verb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$notify</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Activity for files. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$channel_id</td><td></td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$object</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$allow_cid</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$allow_gid</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$deny_cid</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$deny_gid</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$verb</td><td></td></tr>
    <tr><td class="paramtype">boolean</td><td class="paramname">$notify</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Referenced by <a class="el" href="attach_8php.html#a7061d6f24286f27fd924ea8d81e08247">attach_delete()</a>, <a class="el" href="attach_8php.html#a84a8a64c4805e1525b42d4add464833f">attach_store()</a>, and <a class="el" href="classZotlabs_1_1Module_1_1Filestorage.html#a010e48dbc4869078c36f49ae153c6997">Zotlabs\Module\Filestorage\post()</a>.</p>

</div>
</div>
<a class="anchor" id="a1ced6d7fe6aa755ee4cf5cbec8eefeef"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">filepath_macro </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Referenced by <a class="el" href="attach_8php.html#a84a8a64c4805e1525b42d4add464833f">attach_store()</a>, and <a class="el" href="classZotlabs_1_1Module_1_1Photos.html#a0d6e2c668a49cb511cfec0e421d875bb">Zotlabs\Module\Photos\get()</a>.</p>

</div>
</div>
<a class="anchor" id="a4dbfd7e1cef52aa9ef52f4b88929fa86"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">find_filename_by_hash </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$channel_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$attachHash</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the filename of an attachment in a given channel. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$channel_id</td><td>The id of the channel </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$attachHash</td><td>The hash of the attachment </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>string The filename of the attachment </dd></dl>

<p>Referenced by <a class="el" href="attach_8php.html#ab785eb451835c8f8a213042133a12e62">get_cloud_url()</a>, <a class="el" href="attach_8php.html#ad8a92e1ada8ff3126270bff97566d40f">get_dirpath_by_cloudpath()</a>, and <a class="el" href="attach_8php.html#a5634d680a3d80e4fb60b1ffa55145fb1">get_filename_by_cloudname()</a>.</p>

</div>
</div>
<a class="anchor" id="a7f19988ce50d8f872c941a22694c3972"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">find_folder_hash_by_attach_hash </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$channel_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$attachHash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$recurse</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the hash of an attachment's folder. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$channel_id</td><td>The id of the channel </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$attachHash</td><td>The hash of the attachment </td></tr>
    <tr><td class="paramtype">boolean</td><td class="paramname">$recurse</td><td>(optional) default false </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>string </dd></dl>

<p>Referenced by <a class="el" href="attach_8php.html#a84a8a64c4805e1525b42d4add464833f">attach_store()</a>, and <a class="el" href="attach_8php.html#ab785eb451835c8f8a213042133a12e62">get_cloud_url()</a>.</p>

</div>
</div>
<a class="anchor" id="a3ab2051597de1ff1b86e16f142900ad7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">find_folder_hash_by_path </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$channel_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$path</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the hash of an attachment's folder. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$channel_id</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$path</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>string </dd></dl>

</div>
</div>
<a class="anchor" id="a53606bfc162c615180f559a0609aebf2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">get_attach_binname </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Strip off 'store/nickname/' from the provided path. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$s</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>string </dd></dl>

<p>Referenced by <a class="el" href="import_8php.html#a341357f0b55dcf2eed3ab632fff6a707">sync_files()</a>.</p>

</div>
</div>
<a class="anchor" id="ab785eb451835c8f8a213042133a12e62"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">get_cloud_url </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$channel_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$channel_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$attachHash</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns path to parent folder in cloud/. This function cannot be used with mod/dav as it always returns a path valid under mod/cloud. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$channel_id</td><td>The id of the channel </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$channel_name</td><td>The name of the channel </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$attachHash</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>string with the full folder path </dd></dl>

<p>Referenced by <a class="el" href="attach_8php.html#a7061d6f24286f27fd924ea8d81e08247">attach_delete()</a>, <a class="el" href="classZotlabs_1_1Module_1_1Filestorage.html#a15e688a16894866833acf5cd26577270">Zotlabs\Module\Filestorage\get()</a>, and <a class="el" href="classZotlabs_1_1Module_1_1Filestorage.html#a010e48dbc4869078c36f49ae153c6997">Zotlabs\Module\Filestorage\post()</a>.</p>

</div>
</div>
<a class="anchor" id="a6aa00ea010ea030110faefb75eafc1ce"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">get_cloudpath </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$arr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns path to file in cloud/. </p>
<dl class="section warning"><dt>Warning</dt><dd>This function cannot be used with mod/dav as it always returns a path valid under mod/cloud.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$arr</td><td>associative array with:<ul>
<li><em>int</em> <b>uid</b> the channel's uid</li>
<li><em>string</em> <b>folder</b> </li>
<li><em>string</em> <b>filename</b> </li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>string path to the file in cloud/ </dd></dl>

<p>Referenced by <a class="el" href="classZotlabs_1_1Module_1_1Filestorage.html#a15e688a16894866833acf5cd26577270">Zotlabs\Module\Filestorage\get()</a>.</p>

</div>
</div>
<a class="anchor" id="ad8a92e1ada8ff3126270bff97566d40f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">get_dirpath_by_cloudpath </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$path</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Referenced by <a class="el" href="classZotlabs_1_1Module_1_1Webpages.html#a63f69b9dafc236af4e62341a5c3d37c9">Zotlabs\Module\Webpages\post()</a>, and <a class="el" href="import_8php.html#a5d13f0454d1280eb8f0900f7cd2db803">scan_webpage_elements()</a>.</p>

</div>
</div>
<a class="anchor" id="aad5cece3be0c0a3409d8c4a26255f993"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">get_file_activity_object </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$channel_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$url</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create file activity object. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$channel_id</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$hash</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$url</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array An associative array for the specified file. </dd></dl>

<p>Referenced by <a class="el" href="attach_8php.html#a7061d6f24286f27fd924ea8d81e08247">attach_delete()</a>, <a class="el" href="attach_8php.html#a84a8a64c4805e1525b42d4add464833f">attach_store()</a>, and <a class="el" href="classZotlabs_1_1Module_1_1Filestorage.html#a010e48dbc4869078c36f49ae153c6997">Zotlabs\Module\Filestorage\post()</a>.</p>

</div>
</div>
<a class="anchor" id="a5634d680a3d80e4fb60b1ffa55145fb1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">get_filename_by_cloudname </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$cloudname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$storepath</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Referenced by <a class="el" href="import_8php.html#a5d13f0454d1280eb8f0900f7cd2db803">scan_webpage_elements()</a>.</p>

</div>
</div>
<a class="anchor" id="aedd96ecc99d14cf2ddc88c8638fbbe0c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pipe_streams </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$bufsize</em> = <code>16384</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Pipes $in to $out in 16KB chunks. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">resource</td><td class="paramname">$in</td><td>File pointer of input </td></tr>
    <tr><td class="paramtype">resource</td><td class="paramname">$out</td><td>File pointer of output </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$bufsize</td><td>size of chunk, default 16384 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>number with the size </dd></dl>

<p>Referenced by <a class="el" href="attach_8php.html#a84a8a64c4805e1525b42d4add464833f">attach_store()</a>, <a class="el" href="classZotlabs_1_1Module_1_1Attach.html#aafc199affca1d59ec197df9202b81554">Zotlabs\Module\Attach\init()</a>, <a class="el" href="classZotlabs_1_1Module_1_1Photo.html#a4fd1fff235742b2151cf73b789b8d32b">Zotlabs\Module\Photo\init()</a>, <a class="el" href="classZotlabs_1_1Module_1_1Getfile.html#a5583b6d774eff8e3108f86e79a1d7e11">Zotlabs\Module\Getfile\post()</a>, <a class="el" href="attach_8php.html#a4c6f1b70468e38a701414fc240d1cba4">save_chunk()</a>, <a class="el" href="classZotlabs_1_1Thumbs_1_1Video.html#a17b1f517559b053f784d2d741d6a26bb">Zotlabs\Thumbs\Video\Thumb()</a>, and <a class="el" href="classZotlabs_1_1Thumbs_1_1Pdf.html#a20685dcf5cf3c2ffc5130465b3924399">Zotlabs\Thumbs\Pdf\Thumb()</a>.</p>

</div>
</div>
<a class="anchor" id="a4c6f1b70468e38a701414fc240d1cba4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">save_chunk </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Chunked uploader for integration with the blueimp jquery-uploader This is currently used. </p>

<p>Referenced by <a class="el" href="classZotlabs_1_1Module_1_1File__upload.html#a5b1c21449dd5faae85f68ff1038c8d63">Zotlabs\Module\File_upload\post()</a>, <a class="el" href="classZotlabs_1_1Module_1_1Wall__attach.html#a40b935fa19f0fad3724202167c3d8536">Zotlabs\Module\Wall_attach\post()</a>, and <a class="el" href="classZotlabs_1_1Module_1_1Photos.html#a29612aeb73997a308f89d945acd117c5">Zotlabs\Module\Photos\post()</a>.</p>

</div>
</div>
<a class="anchor" id="a6fdd92775f31c07d2863e16e0026018a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">z_mime_content_type </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filename</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Guess the mimetype from file ending. </p>
<p>This function takes a file name and guess the mimetype from the filename extension.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$filename</td><td>a string filename </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>string The mimetype according to a file ending. </dd></dl>

<p>Referenced by <a class="el" href="attach_8php.html#a84a8a64c4805e1525b42d4add464833f">attach_store()</a>, and <a class="el" href="classZotlabs_1_1Daemon_1_1Importdoc.html#ac573658e2e66f945d186647a25417a2f">Zotlabs\Daemon\Importdoc\update_docs_dir()</a>.</p>

</div>
</div>
<a class="anchor" id="aeb07968990e66a88c95483ca09a7f909"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">z_readdir </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$channel_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$observer_hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$pathname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$parent_hash</em> = <code>''</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read a virtual directory and return contents. </p>
<p>Also checking permissions of all parent components.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">integer</td><td class="paramname">$channel_id</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$observer_hash</td><td>hash of current observer </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$pathname</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$parent_hash</td><td>(optional)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array $ret<ul>
<li><em>boolean</em> <b>success</b> boolean true or false</li>
<li><em>string</em> <b>message</b> error message if success is false</li>
<li><em>array</em> <b>data</b> array of attach DB entries without data component </li>
</ul>
</dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->

